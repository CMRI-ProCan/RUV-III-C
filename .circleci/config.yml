version: 2

variables:
  linux: &linux
    docker:
      - image: cmriprocan/cci-ruviii_c-docker-primary:3.6.1

  build: &build
    run:
      command: |
        pwd \
        && ls \ 
        && R CMD INSTALL ./ruviii_c

  common: &common
    run:
      command: |
        printf 'export WORKSPACE=%s\n' $(pwd) >> $BASH_ENV
  test: &test
    run:
      command: |
        cd ${WORKSPACE}/ruviii_c/tests && R -e "source('./testthat.R')"

jobs:
  build-linux:
    <<: *linux
    steps:
      - *common
      - checkout
      - *build
      - *test

workflows:
  version: 2
  ruviii-c-test:
    jobs:
      - build-linux
